// Custom KQL query for detecting fileless malware execution
// Author: PythonSentinel

// Search for process creation events where the parent process is cmd.exe or powershell.exe
ProcessCreation
| where ProcessCommandLine has "rundll32.exe"
| where ParentProcessName in ("cmd.exe", "powershell.exe")
// Exclude known benign processes
| where ParentProcessName != "conhost.exe"
| where ParentProcessName != "explorer.exe"
| where ParentProcessName != "svchost.exe"
// Search for command line arguments that could indicate fileless execution
| where ProcessCommandLine has "-encodedcommand" or ProcessCommandLine has "-encodedcommand"
or ProcessCommandLine has "-encodedcommand " or ProcessCommandLine has "-encodedcommand "
or ProcessCommandLine has "-windowstyle hidden" or ProcessCommandLine has "-w hidden"
or ProcessCommandLine has "-nonewwindow" or ProcessCommandLine has "-nw"
// Add additional filters or conditions as needed
